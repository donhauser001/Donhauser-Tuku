# Donhauser-Tuku (DHS图库)

一个专为设计师打造的WordPress图片和相册管理插件，支持AI智能标签生成、多用户权限管理、相册分类等功能。

## 🚀 主要特性

- **AI智能标签生成** - 支持多种AI服务自动生成图片标签
- **多用户权限管理** - 完整的用户权限控制系统
- **相册管理** - 支持相册创建、分类、权限设置
- **图片管理** - 批量上传、标签管理、收藏功能
- **搜索功能** - 基于标签和相册的智能搜索
- **响应式设计** - 支持移动端和桌面端
- **缓存系统** - 内置缓存机制提升性能

## 📋 系统要求

- **WordPress**: 5.0 或更高版本
- **PHP**: 7.4 或更高版本
- **MySQL**: 5.6 或更高版本
- **内存限制**: 建议至少256MB

## 🛠️ 安装方法

### 方法1：通过WordPress后台安装
1. 下载插件ZIP文件
2. 在WordPress后台 → 插件 → 安装插件
3. 点击"上传插件"并选择ZIP文件
4. 激活插件

### 方法2：手动安装
1. 将插件文件夹上传到 `/wp-content/plugins/` 目录
2. 在WordPress后台激活插件
3. 进入设置页面配置AI服务

## 🤖 AI配置指南

### 支持的AI服务

本插件支持多种AI服务，按优先级排序：

#### 1. LM Studio (本地部署) - 推荐
- **优势**: 完全本地化，无网络依赖，隐私安全
- **配置要求**: 本地运行LM Studio服务
- **默认设置**: `http://localhost:1234/v1/chat/completions`

**配置步骤**:
1. 下载并安装 [LM Studio](https://lmstudio.ai/)
2. 下载支持图像理解的模型（如llava）
3. 启动LM Studio服务
4. 在插件设置中配置API地址和模型名称

**推荐模型**:
- `llava-v1.5-7b` - 平衡性能和准确性
- `llava-v1.6-vicuna-13b` - 更高准确性
- `llava-v1.6-mistral-7b` - 快速处理

#### 2. OpenAI API (云端服务)
- **优势**: 稳定可靠，模型质量高
- **配置要求**: OpenAI API密钥
- **默认模型**: `gpt-4o-mini`

**配置步骤**:
1. 注册 [OpenAI](https://openai.com/) 账户
2. 获取API密钥
3. 在插件设置中输入API密钥
4. 选择适合的模型

#### 3. Hugging Face (备选方案)
- **优势**: 开源模型，成本较低
- **配置要求**: Hugging Face API密钥
- **支持模型**: 图像分类、图像描述、对象检测

### AI设置配置

#### 基础设置
1. 进入 **WordPress后台** → **DHS图库** → **设置**
2. 找到 **AI标签生成** 部分
3. 启用AI标签生成功能

#### LM Studio配置
```php
// 在设置页面配置以下选项：
LM Studio API地址: http://localhost:1234/v1/chat/completions
模型名称: llava-v1.5-7b
API密钥: (可选，如果设置了的话)
```

#### OpenAI配置
```php
// 在设置页面配置以下选项：
OpenAI API密钥: sk-xxxxxxxxxxxxxxxxxxxxxxxx
模型选择: gpt-4o-mini (推荐) 或 gpt-4-vision-preview
```

#### 语言设置
- **中文**: 生成中文标签（默认）
- **英文**: 生成英文标签（需要AI模型支持）
- **自动检测**: 根据图片内容自动选择语言

> **注意**: 英文标签生成功能需要AI模型支持英文输出，界面语言仍为中文。

### AI标签生成使用

#### 单张图片生成标签
1. 在图片管理页面，点击图片下方的"AI标签"按钮
2. 系统自动调用配置的AI服务
3. 生成标签后可以编辑、确认或拒绝

#### 批量生成标签
1. 在相册管理页面，选择"批量AI标签"
2. 选择要处理的相册或图片范围
3. 设置处理数量限制（建议每次不超过50张）
4. 系统自动批量处理并生成标签

#### 标签质量优化
- **调整提示词**: 在AI设置中可以自定义提示词模板
- **标签过滤**: 自动过滤重复和低质量标签
- **人工审核**: 生成的标签需要人工确认后生效

## 📁 功能模块详解

### 相册管理
- **创建相册**: 支持相册名称、描述、封面设置
- **权限控制**: 公开、私有、密码保护等访问权限
- **分类管理**: 支持相册分类和标签
- **批量操作**: 批量删除、移动、权限修改

### 图片管理
- **上传功能**: 支持拖拽上传、批量上传
- **格式支持**: JPG、PNG、TIFF、GIF等主流格式
- **标签系统**: 手动标签、AI标签、标签分类
- **收藏功能**: 用户个人收藏夹
- **搜索功能**: 基于标签、文件名、相册的智能搜索

### 用户权限
- **角色管理**: 管理员、编辑者、贡献者、订阅者
- **权限控制**: 上传、编辑、删除、管理相册等权限
- **内容所有权**: 用户只能管理自己上传的内容

### 短代码使用
```php
// 显示相册列表
[dhs_tuku_albums]

// 显示指定相册的图片
[dhs_tuku_gallery album_id="1"]

// 显示用户收藏
[dhs_tuku_favorites]

// 显示上传表单
[dhs_tuku_upload]
```

## 🔧 高级配置

### 缓存设置
- 启用/禁用缓存功能
- 设置缓存过期时间
- 手动清理缓存

### 上传设置
- 最大文件大小限制
- 允许的文件类型
- 图片质量压缩设置

### 性能优化
- 图片懒加载
- 缩略图生成
- CDN支持配置

## 🚨 故障排除

### AI服务连接问题
1. **检查LM Studio服务状态**
   ```bash
   curl http://localhost:1234/v1/models
   ```

2. **验证API密钥**
   - 确保OpenAI API密钥有效
   - 检查API配额是否充足

3. **网络连接问题**
   - 检查防火墙设置
   - 验证代理配置

### 常见错误及解决方案

#### "LM Studio不可用"错误
- 确保LM Studio服务正在运行
- 检查端口1234是否被占用
- 验证模型是否正确加载

#### "权限不足"错误
- 检查用户角色权限设置
- 确认WordPress用户权限配置
- 验证nonce安全验证

#### "图片上传失败"错误
- 检查文件大小限制
- 验证文件类型是否允许
- 确认目录写入权限

## 📊 性能监控

### 系统统计
- 图片总数和存储空间
- 用户活跃度统计
- AI标签生成成功率
- 系统性能指标

### 日志记录
- 错误日志记录
- 用户操作日志
- AI服务调用日志
- 性能监控日志

## 🔒 安全特性

- **CSRF保护**: 所有表单都有nonce验证
- **权限验证**: 严格的用户权限检查
- **文件类型验证**: 严格的文件上传安全检查
- **SQL注入防护**: 使用WordPress预准备语句
- **XSS防护**: 输出内容自动转义

## 🌐 国际化支持

- **当前状态**: 仅支持中文界面
- **技术基础**: 已集成WordPress国际化框架
- **扩展性**: 支持添加其他语言包
- **时区支持**: 支持时区和日期格式本地化

> **注意**: 目前插件界面仅提供中文版本，英文支持正在开发中。

## 📝 开发文档

### 钩子系统
```php
// 图片上传后钩子
do_action('dhs_tuku_image_uploaded', $image_id, $album_id);

// AI标签生成后钩子
do_action('dhs_tuku_ai_tags_generated', $image_id, $tags);

// 相册创建后钩子
do_action('dhs_tuku_album_created', $album_id);
```

### 过滤器系统
```php
// 自定义AI提示词
add_filter('dhs_tuku_ai_prompt', 'custom_ai_prompt');

// 自定义标签处理
add_filter('dhs_tuku_process_tags', 'custom_tag_processor');
```

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

### 开发环境设置
1. Fork项目仓库
2. 克隆到本地
3. 创建功能分支
4. 提交更改
5. 创建Pull Request

### 代码规范
- 遵循WordPress编码标准
- 使用有意义的变量和函数名
- 添加适当的注释和文档
- 确保代码通过PHP_CodeSniffer检查

## 📄 许可证

本项目采用 [GPL v2](LICENSE) 许可证。

## 👨‍💻 作者

- **开发者**: aiden
- **项目**: Donhauser-Tuku
- **版本**: 1.2.0

## 🙏 致谢

感谢以下开源项目和服务：
- WordPress社区
- OpenAI API
- Hugging Face
- LM Studio
- 所有贡献者和用户

## 📞 支持与反馈

如果您遇到问题或有建议，请：
1. 查看本文档的故障排除部分
2. 在GitHub上提交Issue
3. 联系开发团队

---

**注意**: 使用AI功能时，请确保遵守相关服务的使用条款和隐私政策。